name: Docker Compose Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Validate Docker Compose file
        run: |
          # Check if .env file exists
          if [ ! -f .env ]; then
            echo "Creating temporary .env file for validation..."
            cp env.example .env
          fi

          # Validate docker-compose.yml syntax
          docker-compose config

      - name: Check for sensitive information
        run: |
          # Check for potential secrets in docker-compose.yml
          if grep -q "password\|secret\|key\|token" docker-compose.yml; then
            echo "Warning: Potential sensitive information found in docker-compose.yml"
            exit 1
          fi

      - name: Validate environment variables
        run: |
          # Check if all required variables are present in env.example
          required_vars=("DOMAIN" "TRAEFIK_EMAIL" "BASE_PATH" "TRAEFIK_DASHBOARD_USER" "TRAEFIK_DASHBOARD_PASSWORD")
          for var in "${required_vars[@]}"; do
            if ! grep -q "^$var=" env.example; then
              echo "Error: Required variable $var not found in env.example"
              exit 1
            fi
          done 